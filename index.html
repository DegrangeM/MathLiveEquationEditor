<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <script defer src="//unpkg.com/mathlive"></script>

    <script>

    tinymce.PluginManager.add('MathsLiveEquationEditor', function(editor, url) {
    var openDialog = function () {
        return editor.windowManager.open({
        title: 'Example plugin',
        body: {
            type: 'panel',
            items: [
            {
                type: 'input',
                name: 'title',
                label: 'Title'
            }
            ]
        },
        buttons: [
            {
            type: 'cancel',
            text: 'Close'
            },
            {
            type: 'submit',
            text: 'Save',
            primary: true
            }
        ],
        onSubmit: function (api) {
            var data = api.getData();
            /* Insert content when the window form is submitted */
            editor.insertContent('Title: ' + data.title);
            api.close();
        }
        });
    };
    /* Add a button that opens a window */
    editor.ui.registry.addButton('example', {
        text: 'My button',
        onAction: function () {
        /* Open window */
        openDialog();
        }
    });
    /* Adds a menu item, which can then be included in any menu via the menu/menubar configuration */
    editor.ui.registry.addMenuItem('example', {
        text: 'Example plugin',
        onAction: function() {
        /* Open window */
        openDialog();
        }
    });
    /* Return the metadata for the help plugin */
    return {
        getMetadata: function () {
        return  {
            name: 'Example plugin',
            url: 'http://exampleplugindocsurl.com'
        };
        }
    };
    });

    /*
    The following is an example of how to use the new plugin and the new
    toolbar button.
    */
    tinymce.init({
    selector: '#mytextarea',
    plugins: 'MathsLiveEquationEditor',
    toolbar: 'example | help'
    });

    /*

      tinymce.init({
        selector: '#mytextarea',
        custom_elements : 'math-field',
        extended_valid_elements : 'math-field',
        setup : function(ed) {
            ed.on('init',function(){
                var head = ed.dom.select('head')[0]
                ed.dom.add(
                    head,
                    'script',
                    {
                        src: "https://unpkg.com/mathlive",
                        type: 'text/javascript'
                    }
                );
                var scriptLoader = new tinymce.dom.ScriptLoader();
                scriptLoader.add("https://unpkg.com/mathlive");
                scriptLoader.loadQueue();
                // tinymce.ScriptLoader.load('https://unpkg.com/mathlive');
            });
        }
      });
      */
    </script>

  </head>

  <body>
  <h1>TinyMCE Quick Start Guide</h1>
    <form method="post">
      <textarea id="mytextarea">Hello, World!

        <math-field>f(x) = \sin(x+\pi)</math-field>

        Bye !

      </textarea>
    </form>
  </body>
</html>